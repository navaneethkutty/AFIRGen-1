# AFIRGen Backend - Staging Environment Configuration
# This configuration mirrors production but with relaxed security for testing

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
SERVICE_NAME=afirgen-backend-staging
ENVIRONMENT=staging
DEBUG=false

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_OUTPUT=stdout
# Selective debug logging for troubleshooting
LOG_MODULE_LEVELS=

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# Replace with your staging database credentials
DB_HOST=staging-db.example.com
DB_PORT=3306
DB_USER=afirgen_staging
DB_PASSWORD=${DB_PASSWORD}  # Set via environment or secrets manager
DB_NAME=afirgen_staging
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=false

# ============================================================================
# REDIS CACHE CONFIGURATION
# ============================================================================
# Replace with your staging Redis endpoint
REDIS_HOST=staging-redis.example.com
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=${REDIS_PASSWORD}  # Set via environment or secrets manager
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# ============================================================================
# CELERY CONFIGURATION
# ============================================================================
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@staging-redis.example.com:6379/1
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@staging-redis.example.com:6379/2
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_SOFT_TIME_LIMIT=3300
CELERY_WORKER_PREFETCH_MULTIPLIER=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_WORKER_POOL=prefork
CELERY_WORKER_CONCURRENCY=4

# ============================================================================
# MODEL SERVERS CONFIGURATION
# ============================================================================
# Replace with your staging model server endpoints
MODEL_SERVER_URL=http://staging-llm.example.com:8001
ASR_OCR_SERVER_URL=http://staging-asr.example.com:8002
MODEL_SERVER_TIMEOUT=120
MODEL_SERVER_MAX_RETRIES=3

# ============================================================================
# API CONFIGURATION
# ============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=false
API_KEY=${API_KEY}  # Set via environment or secrets manager

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW_SECONDS=60

# ============================================================================
# CORS CONFIGURATION
# ============================================================================
CORS_ENABLED=true
# Replace with your staging frontend URL
CORS_ORIGINS=https://staging.example.com,https://staging-app.example.com
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=*

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
# Replace with your staging domain
ALLOWED_HOSTS=staging-api.example.com,staging.example.com
SECRET_KEY=${SECRET_KEY}  # Set via environment or secrets manager
REQUIRE_HTTPS=true

# ============================================================================
# FILE UPLOAD CONFIGURATION
# ============================================================================
MAX_UPLOAD_SIZE_MB=50
ALLOWED_AUDIO_TYPES=audio/wav,audio/mpeg,audio/mp4,audio/ogg,audio/flac
ALLOWED_IMAGE_TYPES=image/png,image/jpeg,image/webp
UPLOAD_DIR=/var/afirgen/uploads

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_METRICS_PATH=/metrics

# ============================================================================
# TRACING CONFIGURATION (OpenTelemetry)
# ============================================================================
OTEL_ENABLED=true
# Replace with your staging tracing endpoint
OTEL_EXPORTER_OTLP_ENDPOINT=http://staging-jaeger.example.com:4317
OTEL_SERVICE_NAME=afirgen-backend-staging
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1  # Sample 10% of traces

# ============================================================================
# CACHE TTL CONFIGURATION (seconds)
# ============================================================================
CACHE_TTL_FIR_RECORD=3600
CACHE_TTL_SESSION=86400
CACHE_TTL_KB_QUERY=7200
CACHE_TTL_VIOLATION_CHECK=1800
CACHE_TTL_STATS=300

# ============================================================================
# RETRY CONFIGURATION
# ============================================================================
RETRY_MAX_ATTEMPTS=3
RETRY_BASE_DELAY=1.0
RETRY_MAX_DELAY=60.0
RETRY_EXPONENTIAL_BASE=2.0
RETRY_JITTER=true

# ============================================================================
# CIRCUIT BREAKER CONFIGURATION
# ============================================================================
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3

# ============================================================================
# ALERTING CONFIGURATION
# ============================================================================
# Replace with your staging alerting endpoints
ALERT_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/STAGING/WEBHOOK
ALERT_EMAIL_ENABLED=true
ALERT_EMAIL_TO=staging-alerts@example.com
ALERT_EMAIL_FROM=noreply@example.com

# ============================================================================
# BACKUP CONFIGURATION
# ============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=7
# Replace with your staging backup location
BACKUP_S3_BUCKET=afirgen-staging-backups
BACKUP_S3_REGION=us-east-1
