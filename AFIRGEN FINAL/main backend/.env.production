# AFIRGen Backend - Production Environment Configuration
# CRITICAL: All sensitive values MUST be set via environment variables or secrets manager
# DO NOT commit actual secrets to version control

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
SERVICE_NAME=afirgen-backend
ENVIRONMENT=production
DEBUG=false

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=WARNING
LOG_FORMAT=json
LOG_OUTPUT=stdout
# Only enable debug logging for critical troubleshooting
LOG_MODULE_LEVELS=

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# REQUIRED: Set these via environment variables or AWS Secrets Manager
DB_HOST=${DB_HOST}
DB_PORT=3306
DB_USER=${DB_USER}
DB_PASSWORD=${DB_PASSWORD}
DB_NAME=afirgen
DB_POOL_SIZE=30
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=false

# Database SSL Configuration (recommended for production)
DB_SSL_ENABLED=true
DB_SSL_CA=/etc/ssl/certs/rds-ca-bundle.pem

# ============================================================================
# REDIS CACHE CONFIGURATION
# ============================================================================
# REQUIRED: Set these via environment variables or AWS Secrets Manager
REDIS_HOST=${REDIS_HOST}
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=${REDIS_PASSWORD}
REDIS_MAX_CONNECTIONS=100
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# Redis SSL Configuration (recommended for production)
REDIS_SSL_ENABLED=true

# ============================================================================
# CELERY CONFIGURATION
# ============================================================================
CELERY_BROKER_URL=rediss://:${REDIS_PASSWORD}@${REDIS_HOST}:6379/1
CELERY_RESULT_BACKEND=rediss://:${REDIS_PASSWORD}@${REDIS_HOST}:6379/2
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_SOFT_TIME_LIMIT=3300
CELERY_WORKER_PREFETCH_MULTIPLIER=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_WORKER_POOL=prefork
CELERY_WORKER_CONCURRENCY=8

# ============================================================================
# MODEL SERVERS CONFIGURATION
# ============================================================================
# REQUIRED: Set these to your production model server endpoints
MODEL_SERVER_URL=${MODEL_SERVER_URL}
ASR_OCR_SERVER_URL=${ASR_OCR_SERVER_URL}
MODEL_SERVER_TIMEOUT=120
MODEL_SERVER_MAX_RETRIES=3

# ============================================================================
# API CONFIGURATION
# ============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=8  # Adjust based on CPU cores (2 * cores + 1)
API_RELOAD=false
# REQUIRED: Set via environment variables or secrets manager
API_KEY=${API_KEY}

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW_SECONDS=60

# ============================================================================
# CORS CONFIGURATION
# ============================================================================
CORS_ENABLED=true
# REQUIRED: Set to your production frontend URLs only
CORS_ORIGINS=${CORS_ORIGINS}
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=Content-Type,Authorization,X-API-Key,X-Request-ID

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
# REQUIRED: Set to your production domain(s)
ALLOWED_HOSTS=${ALLOWED_HOSTS}
# REQUIRED: Generate strong random key (e.g., openssl rand -hex 32)
SECRET_KEY=${SECRET_KEY}
REQUIRE_HTTPS=true

# Security Headers
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# ============================================================================
# FILE UPLOAD CONFIGURATION
# ============================================================================
MAX_UPLOAD_SIZE_MB=50
ALLOWED_AUDIO_TYPES=audio/wav,audio/mpeg,audio/mp4,audio/ogg,audio/flac
ALLOWED_IMAGE_TYPES=image/png,image/jpeg,image/webp
# Use S3 or EFS for production file storage
UPLOAD_DIR=/var/afirgen/uploads
UPLOAD_S3_BUCKET=${UPLOAD_S3_BUCKET}
UPLOAD_S3_REGION=${AWS_REGION}

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_METRICS_PATH=/metrics

# CloudWatch Integration (AWS)
CLOUDWATCH_ENABLED=true
CLOUDWATCH_NAMESPACE=AFIRGen/Backend
CLOUDWATCH_REGION=${AWS_REGION}

# ============================================================================
# TRACING CONFIGURATION (OpenTelemetry)
# ============================================================================
OTEL_ENABLED=true
OTEL_EXPORTER_OTLP_ENDPOINT=${OTEL_ENDPOINT}
OTEL_SERVICE_NAME=afirgen-backend
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.01  # Sample 1% of traces in production

# AWS X-Ray Integration (alternative to OTLP)
XRAY_ENABLED=false
XRAY_DAEMON_ADDRESS=127.0.0.1:2000

# ============================================================================
# CACHE TTL CONFIGURATION (seconds)
# ============================================================================
CACHE_TTL_FIR_RECORD=3600
CACHE_TTL_SESSION=86400
CACHE_TTL_KB_QUERY=7200
CACHE_TTL_VIOLATION_CHECK=1800
CACHE_TTL_STATS=300

# ============================================================================
# RETRY CONFIGURATION
# ============================================================================
RETRY_MAX_ATTEMPTS=3
RETRY_BASE_DELAY=1.0
RETRY_MAX_DELAY=60.0
RETRY_EXPONENTIAL_BASE=2.0
RETRY_JITTER=true

# ============================================================================
# CIRCUIT BREAKER CONFIGURATION
# ============================================================================
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3

# ============================================================================
# ALERTING CONFIGURATION
# ============================================================================
# REQUIRED: Set your production alerting endpoints
ALERT_ENABLED=true
ALERT_WEBHOOK_URL=${ALERT_WEBHOOK_URL}
ALERT_EMAIL_ENABLED=true
ALERT_EMAIL_TO=${ALERT_EMAIL_TO}
ALERT_EMAIL_FROM=noreply@example.com
ALERT_SMS_ENABLED=false
ALERT_SMS_NUMBERS=${ALERT_SMS_NUMBERS}

# PagerDuty Integration
PAGERDUTY_ENABLED=false
PAGERDUTY_API_KEY=${PAGERDUTY_API_KEY}
PAGERDUTY_SERVICE_ID=${PAGERDUTY_SERVICE_ID}

# ============================================================================
# BACKUP CONFIGURATION
# ============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 1 * * *  # Daily at 1 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=${BACKUP_S3_BUCKET}
BACKUP_S3_REGION=${AWS_REGION}
BACKUP_ENCRYPTION_ENABLED=true

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================
# Connection Pool Tuning
DB_POOL_PRE_PING=true
DB_POOL_USE_LIFO=true

# Redis Connection Pool
REDIS_CONNECTION_POOL_SIZE=100
REDIS_MAX_CONNECTIONS_PER_POOL=50

# Request Timeout
REQUEST_TIMEOUT=30
SLOW_REQUEST_THRESHOLD=5

# ============================================================================
# COMPLIANCE & AUDIT
# ============================================================================
AUDIT_LOGGING_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=365
AUDIT_LOG_S3_BUCKET=${AUDIT_LOG_S3_BUCKET}

# Data Retention
DATA_RETENTION_DAYS=2555  # 7 years for legal compliance
SOFT_DELETE_ENABLED=true

# ============================================================================
# AWS CONFIGURATION (if using AWS)
# ============================================================================
AWS_REGION=${AWS_REGION}
AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
# Prefer IAM roles over access keys in production

# ============================================================================
# FEATURE FLAGS
# ============================================================================
FEATURE_BACKGROUND_TASKS=true
FEATURE_CACHING=true
FEATURE_RATE_LIMITING=true
FEATURE_TRACING=true
FEATURE_METRICS=true

# ============================================================================
# MAINTENANCE MODE
# ============================================================================
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System is under maintenance. Please try again later."
MAINTENANCE_ALLOWED_IPS=  # Comma-separated IPs that can access during maintenance

# ============================================================================
# NOTES FOR PRODUCTION DEPLOYMENT
# ============================================================================
# 1. All ${VARIABLE} placeholders MUST be replaced with actual values
# 2. Use AWS Secrets Manager, HashiCorp Vault, or similar for secrets
# 3. Never commit this file with actual secrets to version control
# 4. Rotate secrets regularly (every 90 days minimum)
# 5. Use IAM roles instead of access keys when possible
# 6. Enable encryption at rest and in transit for all data
# 7. Configure proper backup and disaster recovery procedures
# 8. Set up monitoring and alerting before going live
# 9. Perform security audit and penetration testing
# 10. Document incident response procedures
