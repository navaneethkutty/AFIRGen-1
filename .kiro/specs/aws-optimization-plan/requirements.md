# Requirements Document: AWS Free Tier Optimization

## Introduction

This document specifies the requirements for deploying the AFIRGen system on AWS infrastructure while maximizing the use of AWS Free Tier services. The system must provide a cost-effective deployment suitable for development, testing, and low-traffic production workloads without incurring AWS charges during the 12-month free tier period.

The AFIRGen system generates Fire Incident Reports (FIRs) using machine learning models for summarization, audio transcription, and image processing. This deployment strategy must balance cost constraints with acceptable performance and reliability.

## Glossary

- **AFIRGen_System**: The complete Fire Incident Report generation system including frontend, backend, and ML models
- **Free_Tier**: AWS services available at no cost for 12 months for new accounts, plus always-free services
- **EC2_Instance**: Amazon Elastic Compute Cloud virtual server running the application
- **RDS_Instance**: Amazon Relational Database Service managed MySQL database
- **CloudFront**: Amazon's Content Delivery Network for serving static frontend assets
- **S3_Bucket**: Amazon Simple Storage Service object storage
- **CloudWatch**: AWS monitoring and logging service
- **FIR**: Fire Incident Report generated by the system
- **GGUF_Model**: Quantized machine learning model format for efficient inference
- **OOM**: Out Of Memory condition where a process exceeds available RAM
- **Docker_Container**: Isolated application runtime environment
- **Quantization**: Process of reducing model precision to decrease size and memory usage

## Requirements

### Requirement 1: Zero-Cost Deployment

**User Story:** As a project stakeholder, I want to deploy the AFIRGen system without incurring AWS costs during the free tier period, so that I can minimize operational expenses during development and testing.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL utilize only AWS services that are included in the Free Tier
2. WHEN any AWS resource is provisioned, THE AFIRGen_System SHALL configure it to stay within Free Tier limits
3. THE AFIRGen_System SHALL monitor daily AWS costs and verify zero charges for Free Tier services
4. WHEN Free Tier limits are approached, THE AFIRGen_System SHALL trigger alerts at 80% utilization
5. THE AFIRGen_System SHALL provide cost monitoring dashboards showing resource usage against Free Tier limits

### Requirement 2: Single Instance Compute Architecture

**User Story:** As a system architect, I want to run all services on a single EC2 instance, so that I can stay within the 750 hours/month Free Tier compute limit.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL deploy all backend services on one t2.micro or t3.micro EC2 instance
2. THE AFIRGen_System SHALL use Docker Compose to orchestrate multiple services on the single instance
3. THE AFIRGen_System SHALL allocate memory limits to each container to prevent exceeding 1GB total RAM
4. WHEN total memory utilization exceeds 90%, THE AFIRGen_System SHALL defer new requests until memory drops below 85%
5. THE AFIRGen_System SHALL provide 30GB of EBS storage for the EC2 instance

### Requirement 3: Model Optimization for Memory Constraints

**User Story:** As a developer, I want ML models to fit within the 1GB RAM constraint, so that all services can run on a single free tier instance.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL use Q4_K_M quantization for GGUF models to reduce size from 7GB to 2.5GB per model
2. THE AFIRGen_System SHALL use the Whisper base model (290MB) instead of larger variants
3. THE AFIRGen_System SHALL store total model files under 5GB to fit in S3 Free Tier storage
4. WHEN models are loaded, THE AFIRGen_System SHALL implement lazy loading to reduce initial memory footprint
5. THE AFIRGen_System SHALL cache models locally on EC2 after initial S3 download to minimize S3 GET requests

### Requirement 4: Frontend Delivery via CDN

**User Story:** As an end user, I want fast frontend loading times, so that I can access the application quickly from any location.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL serve static frontend files from S3 with CloudFront CDN
2. THE AFIRGen_System SHALL enforce HTTPS for all frontend traffic via CloudFront
3. WHEN static assets are requested, THE AFIRGen_System SHALL serve them with appropriate cache headers
4. THE AFIRGen_System SHALL achieve >99% cache hit ratio to minimize origin requests
5. THE AFIRGen_System SHALL compress assets to reduce data transfer and stay under 1TB/month CloudFront limit

### Requirement 5: Database Storage Management

**User Story:** As a system administrator, I want automatic database cleanup, so that storage stays within the 20GB RDS Free Tier limit.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL use a single RDS db.t3.micro MySQL instance with 20GB storage
2. WHEN database storage exceeds 18GB (90% of limit), THE AFIRGen_System SHALL trigger automatic cleanup
3. THE AFIRGen_System SHALL delete validation history older than 90 days during cleanup
4. THE AFIRGen_System SHALL delete archived FIR records older than 180 days during cleanup
5. THE AFIRGen_System SHALL monitor database size daily and alert administrators when approaching limits

### Requirement 6: Acceptable Performance Under Constraints

**User Story:** As an end user, I want FIR generation to complete in a reasonable time, so that I can use the system effectively despite free tier limitations.

#### Acceptance Criteria

1. WHEN generating a text-only FIR, THE AFIRGen_System SHALL complete processing within 45 seconds
2. WHEN generating a FIR with audio input, THE AFIRGen_System SHALL complete processing within 90 seconds
3. WHEN generating a FIR with image input, THE AFIRGen_System SHALL complete processing within 60 seconds
4. THE AFIRGen_System SHALL handle 3 concurrent FIR generation requests without crashing
5. THE AFIRGen_System SHALL support up to 100 FIR generations per day

### Requirement 7: Resilience and Auto-Recovery

**User Story:** As a system administrator, I want automatic recovery from failures, so that the system remains available despite memory constraints.

#### Acceptance Criteria

1. WHEN a Docker container is killed due to OOM, THE AFIRGen_System SHALL automatically restart it within 30 seconds
2. WHEN a container restarts, THE AFIRGen_System SHALL restore service availability without manual intervention
3. THE AFIRGen_System SHALL log detailed memory usage information before OOM crashes
4. THE AFIRGen_System SHALL send email notifications when OOM events occur
5. THE AFIRGen_System SHALL maintain 95% uptime accepting scheduled maintenance windows

### Requirement 8: Cost-Effective Monitoring

**User Story:** As a system administrator, I want to monitor system health, so that I can identify issues while staying within CloudWatch Free Tier limits.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL track exactly 10 custom CloudWatch metrics (the Free Tier limit)
2. THE AFIRGen_System SHALL configure exactly 10 CloudWatch alarms (the Free Tier limit)
3. WHEN log volume exceeds 170MB per day, THE AFIRGen_System SHALL increase log sampling to stay under 5GB/month
4. THE AFIRGen_System SHALL retain logs for 7 days to minimize storage costs
5. THE AFIRGen_System SHALL send email notifications via SNS for critical alarms

### Requirement 9: Security Within Free Tier

**User Story:** As a security officer, I want the system to be secure, so that data and infrastructure are protected without incurring additional costs.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL place the RDS instance in a private subnet with no public access
2. THE AFIRGen_System SHALL restrict EC2 SSH access to specific administrator IP addresses
3. THE AFIRGen_System SHALL encrypt RDS data at rest using AWS-managed keys
4. THE AFIRGen_System SHALL encrypt S3 data at rest using SSE-S3
5. THE AFIRGen_System SHALL enforce TLS 1.2 or higher for all data in transit

### Requirement 10: Storage Optimization

**User Story:** As a system architect, I want efficient storage usage, so that all data fits within Free Tier storage limits.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL store all ML models, frontend assets, and temporary files within 5GB total S3 storage
2. WHEN temporary files are uploaded to S3, THE AFIRGen_System SHALL delete them after 24 hours
3. THE AFIRGen_System SHALL transition database backups to Glacier after 30 days
4. THE AFIRGen_System SHALL limit S3 GET requests to under 20,000 per month
5. THE AFIRGen_System SHALL limit S3 PUT requests to under 2,000 per month

### Requirement 11: Request Queuing for Stability

**User Story:** As a developer, I want request queuing during high load, so that the system remains stable instead of crashing.

#### Acceptance Criteria

1. WHEN memory utilization exceeds 85%, THE AFIRGen_System SHALL queue incoming FIR generation requests
2. WHEN memory drops below 80%, THE AFIRGen_System SHALL process queued requests sequentially
3. THE AFIRGen_System SHALL limit concurrent FIR processing to 3 requests maximum
4. WHEN the queue exceeds 10 requests, THE AFIRGen_System SHALL return HTTP 503 Service Unavailable
5. THE AFIRGen_System SHALL provide queue position feedback to users waiting for processing

### Requirement 12: Database Connection Management

**User Story:** As a database administrator, I want efficient connection pooling, so that the db.t3.micro instance handles connections effectively.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL limit each backend service to maximum 5 database connections
2. THE AFIRGen_System SHALL reuse database connections via connection pooling
3. WHEN a connection is idle for 60 seconds, THE AFIRGen_System SHALL close it
4. THE AFIRGen_System SHALL configure RDS to accept maximum 50 total connections
5. THE AFIRGen_System SHALL monitor active connection count and alert when exceeding 40

### Requirement 13: Simplified Network Architecture

**User Story:** As a cost-conscious architect, I want to avoid NAT Gateway costs, so that networking remains free.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL place the EC2 instance in a public subnet with an Elastic IP
2. THE AFIRGen_System SHALL NOT use a NAT Gateway (which costs $32/month)
3. THE AFIRGen_System SHALL use an S3 Gateway VPC Endpoint for free S3 access from private subnets
4. THE AFIRGen_System SHALL use Nginx on EC2 for SSL termination instead of an Application Load Balancer
5. THE AFIRGen_System SHALL obtain free SSL certificates from Let's Encrypt

### Requirement 14: Data Transfer Optimization

**User Story:** As a system administrator, I want to minimize data transfer, so that usage stays within the 15GB/month Free Tier limit.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL compress all HTTP responses using gzip or brotli
2. THE AFIRGen_System SHALL serve frontend assets from CloudFront to avoid EC2 data transfer charges
3. WHEN data transfer exceeds 12GB/month (80% of limit), THE AFIRGen_System SHALL send alerts
4. THE AFIRGen_System SHALL minimize log verbosity to reduce CloudWatch data transfer
5. THE AFIRGen_System SHALL cache API responses where appropriate to reduce repeated data transfer

### Requirement 15: Backup and Recovery

**User Story:** As a system administrator, I want automated backups, so that data can be recovered without exceeding Free Tier limits.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL configure RDS automated backups with 7-day retention
2. THE AFIRGen_System SHALL schedule backups during low-traffic windows (3:00-4:00 AM UTC)
3. THE AFIRGen_System SHALL store RDS backups within the 20GB Free Tier backup storage limit
4. WHEN backup storage exceeds 18GB, THE AFIRGen_System SHALL reduce retention period
5. THE AFIRGen_System SHALL test backup restoration procedures monthly

### Requirement 16: Infrastructure as Code

**User Story:** As a DevOps engineer, I want infrastructure defined as code, so that deployments are repeatable and version-controlled.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL provide complete Terraform configuration for all AWS resources
2. THE AFIRGen_System SHALL use Terraform variables for environment-specific configuration
3. WHEN Terraform is applied, THE AFIRGen_System SHALL provision all resources within Free Tier limits
4. THE AFIRGen_System SHALL include user data scripts for automated EC2 configuration
5. THE AFIRGen_System SHALL output critical resource identifiers (IPs, endpoints) after provisioning

### Requirement 17: Upgrade Path Documentation

**User Story:** As a project manager, I want a clear upgrade path, so that I know when and how to scale beyond Free Tier.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL document indicators for when to upgrade from Free Tier
2. THE AFIRGen_System SHALL provide step-by-step upgrade instructions for each scaling tier
3. THE AFIRGen_System SHALL estimate costs for each upgrade tier (Basic, Standard, Production)
4. THE AFIRGen_System SHALL document expected performance improvements at each tier
5. THE AFIRGen_System SHALL provide migration scripts for transitioning between tiers

### Requirement 18: Log Sampling and Filtering

**User Story:** As a system administrator, I want intelligent log management, so that critical information is captured while staying under 5GB/month.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL log all errors and warnings without sampling
2. THE AFIRGen_System SHALL log 1 in 10 successful requests (10% sampling rate)
3. THE AFIRGen_System SHALL use structured JSON logging for efficient parsing
4. THE AFIRGen_System SHALL log only INFO level and above (no DEBUG logs in production)
5. THE AFIRGen_System SHALL estimate daily log volume and adjust sampling if approaching limits

### Requirement 19: Model Loading Strategy

**User Story:** As a developer, I want efficient model loading, so that services start quickly despite storage constraints.

#### Acceptance Criteria

1. WHEN the EC2 instance first starts, THE AFIRGen_System SHALL download models from S3 to local disk
2. WHEN model servers restart, THE AFIRGen_System SHALL load models from local disk (not S3)
3. THE AFIRGen_System SHALL complete model loading from local disk within 60 seconds
4. WHEN a model file is corrupted, THE AFIRGen_System SHALL re-download from S3
5. THE AFIRGen_System SHALL verify model checksums after download to ensure integrity

### Requirement 20: Operational Documentation

**User Story:** As a system operator, I want comprehensive documentation, so that I can deploy and maintain the system effectively.

#### Acceptance Criteria

1. THE AFIRGen_System SHALL provide a deployment guide with step-by-step instructions
2. THE AFIRGen_System SHALL provide troubleshooting runbooks for common issues
3. THE AFIRGen_System SHALL document all CloudWatch metrics and their thresholds
4. THE AFIRGen_System SHALL provide disaster recovery procedures
5. THE AFIRGen_System SHALL document security best practices for Free Tier deployment
